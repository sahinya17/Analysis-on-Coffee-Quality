---
title: "Analysing Coffee"
subtitle: ETC5513 Assignment 4, Master of Business Analytics
author: Yiwen Liu, Panagiotis Stylianos, Sahinya Akila
date: '`r Sys.Date()`'
output: 
  html_document:
    css: monashreport.css
    includes:
      before_body: header.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r reading-data}
# Get the Data
coffee_data <- read_csv(here::here("Data/coffee_ratings.csv"))
```

# Introduction 

# Section 1 - Q1 & 2

## How many bags of coffee from each country were sampled? 


```{r bags}
library(tidyverse)
library(leaflet)

# count bags per country
country_bags <- coffee_data %>% 
  group_by(country_of_origin) %>% 
  summarise(total_bags = sum(number_of_bags)) %>% 
  arrange(desc(total_bags)) 

# obtain coordinates
country_coord <- map_data("world") %>% 
  group_by(region) %>% 
  summarise(mean_long = mean(long, na.rm = TRUE),
            mean_lat = mean(lat, na.rm = TRUE))

# join data
country_bags <- country_bags %>% 
  left_join(
    country_coord,
    by = c("country_of_origin" = "region")
  )


mapCountry<- maps::map("world", fill = TRUE, plot = FALSE)  

pal_fun <- colorQuantile("YlOrRd", NULL, n = 7)

total_bags <- country_bags$total_bags[match(mapCountry$names, country_bags$country_of_origin)] 
```

```{r, bagmap}

leaflet(mapCountry) %>% # create a blank canvas
  addProviderTiles("NASAGIBS.ViirsEarthAtNight2012") %>%
  addPolygons( # draw polygons on top of the base map (tile)
    stroke = FALSE, 
    smoothFactor = 0.2, 
    fillOpacity = 1,
    color = ~pal_fun(total_bags)
  ) %>% 
  addCircles(data = country_bags, 
             lat = ~mean_lat, 
             lng =~mean_long, 
             radius = total_bags,
             layerId = country_bags$country_of_origin,
             weight = log(total_bags), 
             stroke = T,  
             fillColor = "white", 
             color = "black", 
             fillOpacity = 3,
             label = paste("Total bags of coffe tested in", 
                           country_bags$country_of_origin, ":", country_bags$total_bags),
             labelOptions = labelOptions(noHide = F, textsize = "15px"),
             popupOptions = country_bags$country_of_origin)
```


## Which country produces the highest rated coffee?


# Section 2 - Q3 & 4

# Section 3 - Q5 & 6

#Conclusion

