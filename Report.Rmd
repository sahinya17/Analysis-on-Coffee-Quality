---
title: "Analysing Coffee"
subtitle: ETC5513 Assignment 4, Master of Business Analytics
author: Yiwen Liu, Panagiotis Stylianos, Sahinya Akila
date: '`r Sys.Date()`'
output: 
  bookdown::html_document2:
    css: monashreport.css
    includes:
      before_body: header.html
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r warning=FALSE, message=FALSE}
library(tidyverse)
library(readr)
library(kableExtra)
library(maps)
```

```{r reading-data, warning=FALSE, message=FALSE}
# Get the Data
coffee_data <- read_csv(here::here("Data/coffee_ratings.csv"))
```

# Introduction 

# Section 1 - Q1 & 2

# Section 2 - Q3 & 4 {#refsection1}

In Section \@ref(refsection1) I want to analyze some interesting content about Arabica coffee beans and Robusta coffee Beans.

## Q3. Which top3 countries cultivated most kinds of Arabica coffee beans and Robusta coffee Beans respectively?

```{r}
species_country <- coffee_data %>% 
  select(country_of_origin, species)
```

```{r warning=FALSE, message=FALSE}
# filter the top3 countries
species_country_count <- species_country %>% 
  group_by(country_of_origin, species) %>% 
  summarise(n=n()) %>% 
  arrange(-n) %>%
  ungroup() %>% 
  group_by(species) %>% 
  slice(1:3)
```

The Table \@ref(tab:species) shows that Mexico, Colombia and Guatemala cultivated the most kinds of Arabica coffee beans and India, Uganda and Ecuador cultivated the most kinds of Robusta coffee Beans. Also it could find that there are much more types of Arabica coffee beans compared to Robusta coffee Beans, which conforms to the content given by @bunn2015bitter.

```{r species}
# make a table
species_country_count %>% 
  kable(caption = "The top3 countries which cultivated most kinds of Arabica coffee beans and Robusta coffee Beans respectively") %>% 
  kable_styling()
```

Now, the Figure \@ref(fig:speciescountry) shows the geographical location of this 6 countries. It could easily find that it seems to be an obvious coffee production zone, which is between the equator and 30 degrees north latitude. In these zones, the annual average temperature and rainfall are in line with the coffee bean growing conditions.

Besides, it indicates that the countries that cultivated Arabica coffee beans are all located in Central and South America, while the countries that cultivated Robusta coffee beans are located in several continents like South America, Eastern Africa and India. It is related to the environment required for the growth of different coffee beans.

```{r}
# world map
world_map <- map_data("world")

# top3 country geo data of two species
top3country <- map_data("world", region = species_country_count$country_of_origin)

# combine top3 country geo data of two species with count data
top3country_geo_count <- top3country %>% 
  left_join(species_country_count, by = c("region"="country_of_origin"))
```

```{r speciescountry, out.width = "100%", fig.width=10, fig.height=7, fig.cap= "The geographical location of the top3 countries which cultivated most kinds of Arabica coffee beans and Robusta coffee Beans respectively"}
# make a map
ggplot(world_map, aes(x = long, y = lat, group = group)) +
  geom_polygon(fill="white", colour = "gray50") +
  geom_polygon(data =top3country_geo_count, aes(x=long, y = lat, group=group,fill=species))+
  scale_x_continuous(breaks = seq(-180, 210, 45), labels = function(x){paste0(x, "°")}) +
  scale_y_continuous(breaks = seq(-60, 100, 30), labels = function(x){paste0(x, "°")}) +
  annotate("text", label = "Colombia", x = -74.2973, y = 4.5709, size = 3)+
  annotate("text", label = "Mexico", x = -102.5528, y = 23.6345, size = 3)+
  annotate("text", label = "Guatemala", x = -90.2308, y = 15.7835, size = 3)+
  annotate("text", label = "India", x = 78.9629, y = 20.5937, size = 3)+
  annotate("text", label = "Uganda", x = 32.2903, y = 1.3733, size = 3)+
  annotate("text", label = "Ecuador", x = -78.1834, y = -1.8312, size = 3)+
  theme_light()
```

## Q7. What is the difference of altitude of Arabica coffee beans and Robusta coffee Beans production areas?

## Q4. In which categories robusta or arabica variety has higher grades?

```{r}
species_grades <- coffee_data %>% 
  select(total_cup_points,species,aroma,flavor,aftertaste,acidity,sweetness) %>% 
  filter(total_cup_points != 0)
```



```{r}
species_grades %>% 
  pivot_longer(-species, names_to = "measure", values_to = "grades") %>% 
  mutate(species = as.factor(species),
         measure = as.factor(measure)) %>% 
  ggplot(aes(x = species, y = grades, color=species)) +
  geom_boxplot()+
  facet_wrap(~measure, scales = "free_y")

```

# Section 3 - Q5 & 6

#Conclusion

